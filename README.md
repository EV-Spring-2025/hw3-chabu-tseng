# PhysGaussian Simulation Assignment Report

This project explores physically-based simulations by combining Gaussian Splatting with MPM (Material Point Method). The objective is to analyze the visual and quantitative impact of different physical parameters on simulation results.


## Project Structure

```
config/
├── plasticine/
│   └── plasticine_{parameter}.json     # Config files for plasticine experiments
├── sand/
│   └── sand_{parameter}.json           # Config files for sand experiments
resource/
├── sand_{parameter}.gif                # Simulation result animations (converted from mp4)
├── plasticine_{parameter}.gif
script/
├── compute_psnr.py                     # Computes PSNR values using baseline images as reference
├── mp4_to_gif.py                       # Converts simulation output .mp4 files to .gif format
├── sweep_config.py                     # Generates multiple config files by varying a parameter from the baseline

```
## Script Using Example

### `compute_psnr.py`

This script calculates the average **PSNR (Peak Signal-to-Noise Ratio)** between two folders of `.png` images. It is typically used to compare output images from a simulation against a baseline to quantify visual similarity.

**Usage:**

```bash
python script/compute_psnr.py \
  --folder_path1 ./output/sand/sand_baseline_config/images \
  --folder_path2 ./output/sand/sand_softening0p01/images
```

- `folder_path1`: Path to the baseline image folder.
- `folder_path2`: Path to the comparison image folder.
- **Note**: Both folders must contain PNG files with matching filenames.
- Output: Prints the average PSNR value across all images.

---

### `mp4_to_gif.py`

This script converts a simulation output `.mp4` video into a `.gif` image for quick visual inspection or inclusion in reports.

**Usage:**

```bash
python script/mp4_to_gif.py \
  --input_mp4 ./output/sand/sand_n_grid64/video.mp4 \
  --output_gif ./resource/sand_n_grid64.gif
```

- `--input_mp4`: Path to the MP4 file generated by simulation.
- `--output_gif`: Path to save the resulting GIF.

---

### `sweep_config.py`

This script automatically generates multiple config files by varying selected parameters from a single baseline config. It is used to systematically test different values for `n_grid`, `substep_dt`, `grid_v_damping_scale`, and `softening`.

**Default behavior (no arguments needed):**

```bash
python script/sweep_config.py
```

- It reads the baseline config from:

  ```
  /tmp2/yctseng/2025spring/ev/hw3-chabu-tseng/config/sand/sand_baseline_config.json
  ```

- For each parameter listed in `SWEEP_PARAMETERS`, it creates multiple modified config files.
- The output configs are saved in:

  ```
  /tmp2/yctseng/2025spring/ev/hw3-chabu-tseng/config/sand/
  ```

- Filenames are formatted like: `sand_softening0p01.json`, `sand_n_grid96.json`, etc.

**To generate config files for other materials (e.g., plasticine):**
- You can modify the following two variables inside `sweep_config.py`:
  - `BASE_CONFIG_PATH`: change to a plasticine baseline config.
  - `SWEEP_PARAMETERS`: redefine which parameters and values to sweep.
- This allows flexible reuse of the script to produce parameter sweep configs for any material or scenario.

## Part 1 – PhysGaussian Baseline

In this part, I construct two baseline configurations using the **PhysGaussian** simulation framework for two different materials: `plasticine` and `sand`. Each baseline is designed to serve as a stable starting point for parameter variation experiments.

### Plasticine Baseline
<img src="./resource/plasticine_baseline.gif" width="400"/>

![Plasticine Baseline](./resource/plasticine_baseline.gif)

The plasticine material is modeled as a relatively soft, dissipative medium. The following parameters were chosen:

```json
{
  "n_grid": 48,
  "substep_dt": 1e-4,
  "grid_v_damping_scale": 0.9999,
  "softening": 1e-2
}
```
This simulation contains 125 frames, as the plasticine scenario is longer in duration and requires finer temporal resolution.

The configuration is the highest stable setting observed for plasticine under memory constraints. Increasing n_grid beyond 48 or substep_dt beyond 1e-4 consistently resulted in CUDA memory errors or simulation crashes due to excessive particle count or grid pressure. This baseline maintains a good balance between stability and resolution for soft materials.

### Sand Baseline
<img src="./resource/sand_baseline.gif" width="400"/>

The sand material exhibits more rigid, granular dynamics and typically requires higher resolution and finer time integration. The following parameters were used:
```json
{
  "n_grid": 200,
  "substep_dt": 2e-5,
  "grid_v_damping_scale": 0.9999,
  "softening": 1e-2
}
```
This simulation contains 50 frames, which is sufficient for capturing the falling and settling behavior of sand.

The baseline uses a very fine grid (n_grid = 200) to capture detailed granular interactions and surface effects. The time step 2e-5 ensures stability given the high stiffness and contact density of sand particles. The damping factor 0.9999 allows for momentum preservation, enabling natural flow behavior. The softening value of 1e-2 prevents singularities and promotes numerical stability in high-density regions.

Both baselines serve as foundations for further single-parameter experiments, which are discussed in subsequent sections.

## Part 2 – Exploring MPM Parameter Effects
### Parameter Sweep Summary (Plasticine)

In this experiment, we vary four key physical simulation parameters for the `plasticine` material to evaluate their effects on the output quality and stability. Each parameter is tested independently, starting from the baseline configuration.

#### 1. `n_grid` – Grid Resolution
Defines the spatial resolution of the simulation grid. Higher values improve precision but increase memory usage.

**Tested values:**

- `24`
- `28`
- `32`
- `40`
- `48` (baseline)

<table>
  <tr>
    <td align="center"><img src="./resource/plasticine_n_grid24.gif" width="150"/><br/>n_grid = 24</td>
    <td align="center"><img src="./resource/plasticine_n_grid28.gif" width="150"/><br/>n_grid = 28</td>
    <td align="center"><img src="./resource/plasticine_n_grid32.gif" width="150"/><br/>n_grid = 32</td>
    <td align="center"><img src="./resource/plasticine_n_grid40.gif" width="150"/><br/>n_grid = 40</td>
    <td align="center"><img src="./resource/plasticine_n_grid48.gif" width="150"/><br/>n_grid = 48 (baseline)</td>
  </tr>
</table>


#### 2. `substep_dt` – Simulation Substep Size
Controls the time step for each subframe. Smaller values improve numerical stability, while larger values reduce runtime.

**Tested values:**

- `1e-5`
- `5e-6`
- `2e-5`
- `1e-4` (baseline)

#### 3. `grid_v_damping_scale` – Velocity Damping Factor
Determines how much the velocity field is damped each step. Lower values add strong dissipation; higher values preserve momentum.

**Tested values:**

- `0.1`
- `0.5`
- `0.7`
- `0.9999` (baseline)
- `1.5`

#### 4. `softening` – Particle Interaction Softening
Prevents numerical instability from hard contacts by smoothing interactions. Higher values reduce stiffness.

**Tested values:**

- `1e-5`
- `1e-3`
- `2e-3`
- `5e-3`
- `1e-2` (baseline)


# Reference
```bibtex
@inproceedings{xie2024physgaussian,
    title     = {Physgaussian: Physics-integrated 3d gaussians for generative dynamics},
    author    = {Xie, Tianyi and Zong, Zeshun and Qiu, Yuxing and Li, Xuan and Feng, Yutao and Yang, Yin and Jiang, Chenfanfu},
    booktitle = {Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition},
    year      = {2024}
}
```
